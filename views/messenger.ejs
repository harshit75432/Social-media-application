<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title><%= title %></title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
        <link rel="stylesheet" href="/css/messenger.css">
        <link rel="stylesheet" href="/css/style.css">
    </head>
    <body style="background-color: #f6f4f4" >
      
<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>

<!-- char-area -->

  <section id="get-userId" class="message-area" data-user_id="<%=session.user_id%>" data-friend_id="<%= friend_id %>">
   
      <div class="row">
        <div class="col-12">
          <div class="chat-area">
            <!-- chatlist -->
            <div class="chatlist">
              <div class="modal-dialog-scrollable">
                <div class="modal-content">
                  <div class="chat-header">
                      <h4 class="mb-3" style="font-weight: bold;">Chats</h4>
                      <form method="get">
                        <div class="msg-search">
                          <input type="text" name="search" class="form-control" id="inlineFormInputGroup" placeholder="Search" aria-label="search">
                          <button type="submit" style="border: none; background-color: white;"><i class="bi bi-search-heart mx-2"></i></button> 
                        </div>
                      </form>
  
                  </div>
  
                  <div class="modal-body">
                    <!-- chat-list -->
                      <div class="chat-lists">
                        
                        <div class="tab-content" id="myTabContent">
                            <div class="tab-pane fade show active" id="Open" role="tabpanel" aria-labelledby="Open-tab">
                              <!-- chat-list -->
                              <div class="chat-list">
                                <% for(let i=0;i<friends_details.length;i++){ %>
                                    <a href="/messenger/<%= friends_details[i].friend_id %>" class="d-flex align-items-center">
                                    <div class="flex-shrink-0">
                                      <img class="d-flex justify-content-center align-items-center" src="<%= friends_details[i].image ? friends_details[i].image : '/images/profile-pic.png' %>" width="40px" height="40px" style="border-radius: 50%; object-fit: cover;" alt="user img">
  
                                    <% if(friends_details[i].status == '1'){ %>
                                      <span class="active"></span>
                                    <% } %>
                                    </div>
                                    <div class="flex-grow-1 ms-3">
                                      <h3><%= friends_details[i].name %></h3>
                                    </div>
                                    
                                  </a>
                                <% } %>
                              
  
                              </div>
                              <!-- chat-list -->
                            </div>
                            <div class="tab-pane fade" id="Closed" role="tabpanel" aria-labelledby="Closed-tab">
  
                              <!-- chat-list -->
                              <div class="chat-list">
                                  <% for(let i=0;i<friends_details.length;i++){ %>
                                    <a href="/messenger/<%= friends_details[i].friend_id %>" class="d-flex align-items-center">
                                      <div class="flex-shrink-0">
                                        <img class="" src="<%= friends_details[i].image ? friends_details[i].image : '/images/profile-pic.png' %>" width="30px" height="30px" style="border-radius: 50%; object-fit: cover;" alt="user img">
                                        <span class="active"></span>
                                      </div>
                                      <div class="flex-grow-1 ms-3">
                                        <h3><%= friends_details[i].name %></h3>
  
                                      </div>
                                    </a>
                                  <% } %>
                              </div>
                              <!-- chat-list -->
                            </div>
                        </div>
                        
                      </div>
                    <!-- chat-list -->
                  </div>
                </div>
              </div>
            </div>
            <!-- chatlist -->
  
            <!-- chatbox -->
            <div class="chatbox showbox">
              <div class="modal-dialog-scrollable">
                <div class="modal-content">
                  <div class="msg-head">
                    <div class="row">
                      <div class="col-8">
                        <div class="d-flex align-items-center">
                          <span class="chat-icon"><img class="img-fluid" src="https://mehedihtml.com/chatbox/assets/img/arroleftt.svg" alt="image title"></span>
                          <div class="flex-shrink-0">
                            <img class="d-flex align-items-center justify-content-center" src="<%= user.profile_pic ? user.profile_pic : '/images/profile-pic.png' %>" width="40px" height="40px" style="border-radius: 50%; object-fit: cover;" alt="user img">
                          </div>
                          <div class="flex-grow-1 ms-3">
                            <h3><%=user.first_name%> <%= user.last_name %></h3>
                            <span class="typing"></span>
                          </div>
                        </div>
                      </div>
                      <div class="col-4">
                        <ul class="moreoption">
                          <li class="navbar nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false"><i class="fa fa-ellipsis-v" aria-hidden="true"></i></a>
                            <ul class="dropdown-menu">
                              <li><a class="dropdown-item" href="#">Action</a></li>
                              <li><a class="dropdown-item" href="#">Another action</a></li>
                              <li>
                                <hr class="dropdown-divider">
                              </li>
                              <li><a class="dropdown-item" href="#">Something else here</a></li>
                            </ul>
                          </li>
                        </ul>
                      </div>
                    </div>
                  </div>
  
                  <div class="modal-body">
                    <div id="messager-list" class="msg-body">
                      <ul id="message-list">
                        <% for(let i=0;i<chats.length;i++){ %>
                          <% if(session.user_id == chats[i].reply_id && chats[i].sender_id == friend_id){ %>
                            <li class="repaly">
                             <% if(chats[i].message != ''){ %>
                                <p><%= chats[i].message %> </p>
                             <% } %>
                                  
                            
                     <div>
                      <img src="<%= chats[i].images[0]%>" width="200px" alt="">
                     </div>             
                                <span class="time"><%= chats[i].time%>
                                  <% if(chats[i].status == 'true'){ %>
                                      <i id="checkid" class="bi bi-check2-all" style="color: blue"></i> 
                                 <% }else{ %>
                                      <i class="bi bi-check2-all"></i>
                                 <% } %> 
                                </span>
                            </li>
                          <% }else{ %>
                            <li class="sender">
                              <p><%= chats[i].message %></p>
                              <div>
                                <img src="<%= chats[i].images[0]%>" width="200px" alt="">
                               </div> 
                              <span class="time"><%= chats[i].time %> </span>
                            </li>
                        <% } %>
                        
                        <% } %>
  
                        <li>
                          <div class="divider">
                            <h6>Today</h6>
                          </div>
                        </li>
                      </ul>
                    </div>
                  </div>
  
                  <div class="send-box">
                    <form id="message-form" method="post">
                      <input id="input" type="text" class="form-control" placeholder="Write messageâ€¦">
  
                      <button id="send-message" type="submit" data-user_id="<%= session.user_id %>" data-friend_id="<%= friend_id %>"><i class="fa fa-paper-plane"  aria-hidden="true"></i> Send</button>
                    
  
                      <div class="send-btns">
                        <div class="attach">
                        
                            <div class="button-wrapper">
                              <span class="label">
                                <img class="img-fluid" src="https://mehedihtml.com/chatbox/assets/img/upload.svg" alt="image title"> attached file
                              </span><input type="file" name="upload" id="upload" class="upload-box"  placeholder="Upload File" multiple="multiple" aria-label="Upload File">
                            </div>
                          
                        </div>
                      </div>
  
                  </form>
                  </div>
              
                </div>
              </div>
            </div>
            <div class="right-side">
                <div class="d-flex flex-column align-items-center">
                  <img src="<%= user.profile_pic ? user.profile_pic : '/images/profile-pic.png' %>" width="100px" height="100px" style="border-radius: 50%; object-fit: cover;" alt="">
                 
                  <span class="mt-2" style="font-weight: 500; font-size: 20px;"><%= user.first_name %> <%= user.last_name %></span>
             </div>
             <div class="d-flex mt-3 justify-content-center align-items-center w-100">
                  <div class="d-flex flex-column align-items-center justify-content-center w-100">
                      <i class="bi bi-person-circle fs-4 p-2 d-flex align-items-center" style="background-color: #e4e3e3; border-radius: 50%;"></i>
                      <span style="font-size: 14px;">Profile</span>
                  </div>
                  <div class="d-flex flex-column align-items-center justify-content-center w-100">
                      <i class="bi bi-bell-fill fs-4 p-2 d-flex align-items-center" style="background-color: #e4e3e3; border-radius: 50%;"></i>
                      <span style="font-size: 14px;">Mute</span>
                  </div>
                  <div class="d-flex flex-column align-items-center  justify-content-center w-100">
                      <i class="bi bi-search fs-4 p-2 d-flex align-items-center" style="background-color: #e4e3e3; border-radius: 50%;"></i>
                      <span style="font-size: 14px;">Search</span>
                  </div>
             </div>
  
            </div>
            
            
          </div>
          <!-- chatbox -->
  
        </div>
      </div>
  
  
  </section>

<!-- char-area -->

<script src="http://localhost:3000/socket.io/socket.io.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script src="/js/messenger.js"></script>
<script src="/js/notification.js"></script>
<script src="/js/extraHome.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script>
</div>
    </body>

</body>
</html>